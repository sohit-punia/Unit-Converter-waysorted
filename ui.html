<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Waysorted — Unit Conversion (Final)</title>
<style>
  :root{
    --bg:#181818;
    --panel:#242424;
    --panel-2:#282828;
    --muted:#9ea6ab;
    --muted-2:#7c8387;
    --accent:#2b66ee;
    --white:#ffffff;
    --card-border: rgba(255,255,255,0.04);
    --radius:14px;
    --pad:14px;
    --fs-sm:12px;
    --fs-xs:11px;
  }

  html,body{margin:0;padding:0;background:transparent;font-family:Inter,system-ui,"Segoe UI",Roboto,Arial;color:var(--white);font-size:var(--fs-sm);}
  .wrap{padding:10px; box-sizing:border-box;}
  .panel {
    width:100%;
    height:260px; /* fixed height to match screenshot */
    border-radius:var(--radius);
    background: linear-gradient(180deg,var(--panel-2), #222);
    border:1px solid var(--card-border);
    padding:var(--pad);
    box-sizing:border-box;
    display:flex;
    gap:18px;
    align-items:flex-start;
    position:relative;
    overflow:hidden;
  }

  /* LEFT area */
  .left { flex:0 0 58%; display:flex; flex-direction:column; gap:10px; }

  .header { display:flex; align-items:center; gap:12px; }
  .logo { width:34px;height:24px;border-radius:6px;background:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px; }
  .plugin-title { font-weight:600; font-size:13px; color:var(--white); }

  .close-container { margin-left:auto; display:flex; gap:8px; align-items:center; }
  .close-btn { background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--white);padding:6px 10px;border-radius:8px;font-size:12px;cursor:pointer; }

  .row { display:flex; gap:10px; align-items:center; }
  label { display:flex; gap:8px; align-items:center; color:var(--muted); font-size:var(--fs-xs); white-space:nowrap; }
  select, input[type="number"], input[type="text"] {
    background:#2b2b2b; border:1px solid rgba(255,255,255,0.03); color:var(--white); padding:6px 8px; border-radius:8px; font-size:var(--fs-sm); outline:none;
  }
  .small { min-width:60px; }

  /* LENGTH / WIDTH boxes reduced width to match screenshot */
  .sizes { display:flex; gap:10px; align-items:center; width:100%; }
  .size-box { background:#2a2a2a; border-radius:8px; padding:8px 10px; min-width:92px; color:var(--white); font-size:var(--fs-sm); } /* tightened */
  .size-box input { background:transparent; border:none; outline:none; color:var(--white); width:100%; font-size:var(--fs-sm); }

  .swap-btn { background:transparent;border:1px solid rgba(255,255,255,0.04); color:var(--muted); padding:6px 8px; border-radius:8px; cursor:pointer; }

  /* bleed inputs slightly tighter */
  .bleed-row { display:flex; gap:8px; align-items:center; color:var(--muted-2); }
  .bleed-row input { width:60px; background:#2a2a2a; border-radius:6px; border:1px solid rgba(255,255,255,0.03); padding:6px 8px; color:var(--white); }

  .actions { display:flex; gap:10px; margin-top:6px; }
  .btn { background:var(--accent); color:white; padding:8px 14px; border-radius:8px; border:none; cursor:pointer; font-size:13px; }
  .btn.ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--white); }

  /* RIGHT area */
  .right { flex:1; display:flex; flex-direction:column; gap:8px; min-width:380px; }

  .presets-header { display:flex; justify-content:space-between; align-items:center; }
  .tabs { display:flex; gap:10px; align-items:center; }
  .tab { padding:6px 10px; border-radius:10px; background:transparent; color:var(--muted); border:1px solid transparent; font-size:var(--fs-xs); cursor:pointer; }
  .tab.active { background: rgba(255,255,255,0.03); color:var(--white); border-color:rgba(255,255,255,0.04); }

  .chip-row { display:flex; gap:8px; align-items:center; margin-top:6px; }
  .chip { padding:6px 10px; border-radius:14px; background:rgba(255,255,255,0.02); color:var(--muted); cursor:pointer; font-size:var(--fs-xs); }
  .chip.active { background:var(--accent); color:white; }

  .preset-area { margin-top:8px; border-radius:10px; border:1px solid rgba(255,255,255,0.02); padding:12px; background: rgba(255,255,255,0.01); box-sizing:border-box; height:140px; }
  .preset-row { display:flex; gap:12px; align-items:flex-start; height:72px; overflow:hidden; }

  .preset-card { width:60px; height:60px; background:#2a2a2a; border-radius:10px; display:flex; align-items:center; justify-content:center; position:relative; cursor:pointer; border:1px solid rgba(255,255,255,0.02); }
  .preset-card .heart { position:absolute; top:8px; left:8px; width:18px; height:18px; border-radius:6px; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.02); color:var(--muted); font-size:11px; }
  .preset-card .heart.fav { background:var(--accent); color:white; }
  .preset-labels { display:flex; gap:22px; margin-top:8px; align-items:center; color:var(--muted-2); font-size:12px; }

  .preset-footer { display:flex; justify-content:flex-end; align-items:center; margin-top:6px; }
  .refresh-btn { background:transparent;border:1px solid rgba(255,255,255,0.06); padding:6px 10px;border-radius:8px;color:var(--white); cursor:pointer; }

  .chev-wrap { position:absolute; left:50%; transform:translateX(-50%); bottom:-10px; width:28px; height:18px; display:flex; align-items:center; justify-content:center; }

  /* hide scrollbars */
  .panel::-webkit-scrollbar{display:none;}
  .preset-area::-webkit-scrollbar{display:none;}
</style>
</head>
<body>
  <div class="wrap">
    <div class="panel" role="region" aria-label="Waysorted Unit Conversion final">
      <!-- LEFT -->
      <div class="left">
        <div class="header">
          <div class="logo">W</div>
          <div class="plugin-title">Unit Conversion</div>
          <div class="close-container">
            <button id="closeBtn" class="close-btn">Close</button>
          </div>
        </div>

        <div class="row" style="margin-top:4px;">
          <label>Unit
            <select id="unitSelect" class="small">
              <option value="MM">MM</option>
              <option value="CM">CM</option>
              <option value="CM">Meter</option>
              <option value="IN">Inch</option>
              <option value="FT">Feet</option>
            </select>
          </label>

          <label>DPI
            <select id="dpiSelect" class="small">
              <option value="72">72 DPI</option>
              <option value="150">150 DPI</option>
              <option value="300">300 DPI</option>
            </select>
          </label>

          <label style="margin-left:8px;">
            <input id="addBleed" type="checkbox" /> <span style="margin-left:6px;color:var(--muted);font-size:var(--fs-xs);">Add Bleed</span>
          </label>
        </div>

        <div class="row" style="margin-top:6px;">
          <div style="flex:1;">
            <div style="color:var(--muted);font-size:var(--fs-xs);margin-bottom:6px;">Length</div>
            <div class="size-box"><input id="lengthInput" type="number" placeholder="0"></div>
          </div>

          <div style="display:flex;align-items:center;justify-content:center;">
            <button id="swapBtn" class="swap-btn" title="swap">⇄</button>
          </div>

          <div style="flex:1;">
            <div style="color:var(--muted);font-size:var(--fs-xs);margin-bottom:6px;">Width</div>
            <div class="size-box" style="display:flex;align-items:center;gap:8px;">
              <input id="widthInput" type="number" placeholder="0" style="flex:1;">
              <div style="color:var(--muted);font-size:var(--fs-xs);min-width:26px;text-align:center;">px</div>
            </div>
          </div>
        </div>

        <div class="row" style="margin-top:6px;">
          <div class="bleed-row">
            <div style="color:var(--muted);font-size:var(--fs-xs);margin-right:6px;">Bleed</div>
            <input id="bleedTop" type="number" placeholder="Top">
            <input id="bleedBottom" type="number" placeholder="Bottom">
            <input id="bleedLeft" type="number" placeholder="Left">
            <input id="bleedRight" type="number" placeholder="Right">
          </div>
        </div>

        <div class="actions">
          <button id="exportBtn" class="btn">Export as Frame</button>
          <button id="savePresetBtn" class="btn ghost">Save As Preset</button>
          <button id="orientationBtn" class="btn ghost">Orientation</button>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="right">
        <div class="presets-header">
          <div style="display:flex;flex-direction:column;">
            <!-- <div style="font-weight:600;color:var(--white);">Your Presets</div> -->
            <div class="tabs" style="margin-top:6px;">
              <button id="tabYour" class="tab active">Your Presets</button>
              <button id="tabAll" class="tab">All Presets</button>
            </div>
          </div>

          <div style="display:flex;flex-direction:column;align-items:flex-end;">
            <div class="chip-row">
              <div id="chipAll" class="chip active">All</div>
              <div id="chipFav" class="chip">Favorites</div>
            </div>
          </div>
        </div>

        <div class="preset-area">
          <div class="preset-row" id="presetRow" role="list" aria-label="Presets row"></div>
          <div class="preset-labels" id="presetLabels"></div>
          <div class="preset-footer"><button id="refreshBtn" class="refresh-btn">Refresh</button></div>
        </div>
      </div>

      <div class="chev-wrap" aria-hidden="true">
        <svg width="20" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 10L12 16L18 10" stroke="rgba(255,255,255,0.9)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
    </div>
  </div>

<script>
  
/* CONFIG: set your backendBaseUrl if you have real backend, otherwise leave blank for demo */
const backendBaseUrl = '';

/* plugin comms */
function postToPlugin(msg){ parent.postMessage({ pluginMessage: msg }, '*'); }
window.onmessage = (e) => {
  const msg = e.data.pluginMessage;
  if (!msg) return;
  if (msg.type === 'export-ready') {
    const base64 = msg.base64;
    const fileName = msg.fileName || 'export.png';
    const binary = atob(base64);
    const len = binary.length;
    const u8 = new Uint8Array(len);
    for (let i=0;i<len;i++) u8[i] = binary.charCodeAt(i);
    const blob = new Blob([u8], { type:'image/png' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = fileName; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }
  if (msg.type === 'export-failed') {
    console.error('Export failed:', msg.error);
  }
};

/* UI refs */
const unitSelect = document.getElementById('unitSelect');
const dpiSelect = document.getElementById('dpiSelect');
const lengthInput = document.getElementById('lengthInput');
const widthInput = document.getElementById('widthInput');
const exportBtn = document.getElementById('exportBtn');
const savePresetBtn = document.getElementById('savePresetBtn');
const swapBtn = document.getElementById('swapBtn');
const closeBtn = document.getElementById('closeBtn');
const presetRow = document.getElementById('presetRow');
const presetLabels = document.getElementById('presetLabels');
const refreshBtn = document.getElementById('refreshBtn');
const tabYour = document.getElementById('tabYour');
const tabAll = document.getElementById('tabAll');
const chipAll = document.getElementById('chipAll');
const chipFav = document.getElementById('chipFav');

/* in-memory demo presets */
let presets = [
  {_id:'p1', title:'Banner', width:800, height:300, unit:'MM', dpi:72, favorite:true},
  {_id:'p2', title:'V-Card', width:350, height:200, unit:'MM', dpi:72, favorite:false},
  {_id:'p3', title:'Standee', width:800, height:1800, unit:'MM', dpi:72, favorite:false},
  {_id:'p4', title:'Bi fold', width:420, height:297, unit:'MM', dpi:72, favorite:false},
  {_id:'p5', title:'Brochure', width:210, height:297, unit:'MM', dpi:72, favorite:false}
];

let activeTab = 'your';
let activeChip = 'all';

function renderPresets(){
  presetRow.innerHTML = '';
  presetLabels.innerHTML = '';
  let items = presets.slice();
  if (activeTab === 'your') items = items;
  if (activeChip === 'fav') items = items.filter(p => p.favorite);

  items.slice(0,8).forEach(p => {
    const c = document.createElement('div'); c.className='preset-card';
    const heart = document.createElement('div'); heart.className='heart' + (p.favorite? ' fav':''); heart.innerHTML = p.favorite ? '♥' : '♡';
    heart.addEventListener('click', (ev)=>{ ev.stopPropagation(); p.favorite=!p.favorite; heart.classList.toggle('fav', p.favorite); heart.innerHTML = p.favorite ? '♥' : '♡'; });
    c.appendChild(heart);
    c.addEventListener('click', ()=> { applyPreset(p); });
    presetRow.appendChild(c);

    const lbl = document.createElement('div'); lbl.style.minWidth='60px'; lbl.style.textAlign='center'; lbl.style.fontSize='12px'; lbl.style.color='var(--muted-2)'; lbl.textContent = p.title;
    presetLabels.appendChild(lbl);
  });

  // placeholders so labels line up like screenshot
  const current = presetRow.children.length;
  for (let i=current; i<5; i++){
    const blank = document.createElement('div'); blank.style.width='60px'; blank.style.height='60px'; blank.style.marginRight='12px';
    presetRow.appendChild(blank);
    const blankLabel = document.createElement('div'); blankLabel.style.minWidth='60px'; blankLabel.style.visibility='hidden';
    presetLabels.appendChild(blankLabel);
  }
}

function applyPreset(p){
  lengthInput.value = p.height || '';
  widthInput.value = p.width || '';
  unitSelect.value = p.unit || 'MM';
  dpiSelect.value = p.dpi ? String(p.dpi) : '72';
}

exportBtn.addEventListener('click', ()=>{
  const dpi = Number(dpiSelect.value) || 72;
  postToPlugin({ type:'export-frame', dpi, fileName: 'export.png' });
});

savePresetBtn.addEventListener('click', ()=>{
  const title = prompt('Preset name');
  if(!title) return;
  const newP = {_id:'p'+Date.now(), title, width:Number(widthInput.value)||0, height:Number(lengthInput.value)||0, unit:unitSelect.value||'MM', dpi:Number(dpiSelect.value)||72, favorite:false};
  presets.unshift(newP);
  renderPresets();
});

swapBtn.addEventListener('click', ()=>{
  const t = lengthInput.value; lengthInput.value = widthInput.value; widthInput.value = t;
});

refreshBtn.addEventListener('click', ()=> renderPresets());
closeBtn.addEventListener('click', ()=> postToPlugin({ type:'close' }));

tabYour.addEventListener('click', ()=>{ activeTab='your'; tabYour.classList.add('active'); tabAll.classList.remove('active'); renderPresets(); });
tabAll.addEventListener('click', ()=>{ activeTab='all'; tabAll.classList.add('active'); tabYour.classList.remove('active'); renderPresets(); });

chipAll.addEventListener('click', ()=>{ activeChip='all'; chipAll.classList.add('active'); chipFav.classList.remove('active'); renderPresets(); });
chipFav.addEventListener('click', ()=>{ activeChip='fav'; chipFav.classList.add('active'); chipAll.classList.remove('active'); renderPresets(); });

renderPresets();
</script> 
</body>
</html>
