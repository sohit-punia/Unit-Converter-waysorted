<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Waysorted — Unit Conversion (Final)</title>
<style>
:root{
  --bg:#181818;
  --panel:#242424;
  --panel-2:#282828;
  --muted:#9ea6ab;
  --muted-2:#7c8387;
  --accent:#2b66ee;
  --white:#ffffff;
  --card-border: rgba(255,255,255,0.04);
  --radius:14px;
  --pad:14px;
  --fs-sm:12px;
  --fs-xs:11px;
}

html,body{margin:0;padding:0;background:transparent;font-family:Inter,system-ui,"Segoe UI",Roboto,Arial;color:var(--white);font-size:var(--fs-sm);}
.wrap{padding:10px; box-sizing:border-box;}
.panel {
  width:100%;
  height:260px;
  border-radius:var(--radius);
  background: linear-gradient(180deg,var(--panel-2), #222);
  border:1px solid var(--card-border);
  padding:var(--pad);
  box-sizing:border-box;
  display:flex;
  gap:12px;
  align-items:flex-start;
  position:relative;
  overflow:hidden;
}

/* LEFT area (main) */
.left { flex:0 0 58%; display:flex; flex-direction:column; gap:8px; position:relative; }

.header { display:flex; align-items:center; gap:12px; }
.logo { width:34px;height:24px;border-radius:6px;background:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px; }
.plugin-title { font-weight:600; font-size:13px; color:var(--white); }

.row { display:flex; gap:10px; align-items:center; }
label { display:flex; gap:8px; align-items:center; color:var(--muted); font-size:var(--fs-xs); white-space:nowrap; }
select, input[type="number"], input[type="text"] {
  background:#2b2b2b; border:1px solid rgba(255,255,255,0.03); color:var(--white); padding:6px 8px; border-radius:8px; font-size:var(--fs-sm); outline:none;
}
.small { min-width:60px; }

/* Grid with two rows: left column = length/width; right column is presets.
   Bleed is absolutely positioned inside .left so it sits next to Add Bleed. */
.sizes-block {
  display:grid;
  grid-template-columns: 1fr;
  grid-template-rows: auto auto;
  column-gap:8px;
  row-gap:12px;
  width:100%;
  box-sizing:border-box;
}

/* size row (left column) */
.size-row {
  display:flex;
  align-items:center;
  gap:10px;
}
.size-label { color:var(--muted); font-size:var(--fs-xs); min-width:44px; }

.pair { display:flex; align-items:center; gap:6px; }
.short { width:48px; height:26px; background:#2a2a2a; border-radius:8px; border:1px solid rgba(255,255,255,0.03); display:flex; align-items:center; }
.short input{ background:transparent; border:none; outline:none; color:var(--white); width:100%; padding:0 6px; font-size:13px; }

.swap-mini{ width:28px; height:26px; display:flex; align-items:center; justify-content:center; background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted); border-radius:8px; cursor:pointer; }

.px-inline { margin-left:6px; color:var(--muted); font-size:var(--fs-xs); min-width:20px; text-align:left; }

/* Bleed group: absolutely positioned inside .left so it sits immediately to the right of Add Bleed.
   top/left may be tweaked if you want a small nudge. */
.bleed-block {
  position:absolute;
  left: 260px;   /* adjust if you want to nudge horizontally */
  top: 72px;     /* adjust if you want to nudge vertically */
  display:flex;
  flex-direction:column;
  gap:12px;
  align-items:flex-start;
  pointer-events:auto;
}

.bleed-row { display:flex; gap:10px; align-items:center; }
.bleed-cell { display:flex; flex-direction:column; align-items:flex-start; gap:6px; min-width:64px; }
.bleed-label { color:var(--muted); font-size:11px; }
.bleed-input { width:54px; height:28px; background:#2a2a2a; border-radius:8px; border:1px solid rgba(255,255,255,0.03); display:flex; align-items:center; justify-content:center; }
.bleed-input input { background:transparent; border:none; outline:none; color:var(--white); width:100%; padding:0 6px; font-size:13px; text-align:center; }

/* Buttons: moved down slightly so they don't cut bleed boxes */
.actions { display:flex; gap:10px; margin-top:18px; align-items:center; } /* <-- moved down (18px) */
.btn { background:var(--accent); color:var(--white); padding:8px 14px; border-radius:8px; border:none; cursor:pointer; font-size:13px; }
.btn.ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--white); }

/* RIGHT area (presets) */
.right { flex:1; display:flex; flex-direction:column; gap:8px; min-width:320px; }

.presets-header { display:flex; justify-content:space-between; align-items:center; gap:12px; }
.tabs { display:flex; gap:10px; align-items:center; }
.tab { padding:6px 10px; border-radius:10px; background:transparent; color:var(--muted); border:1px solid transparent; font-size:var(--fs-xs); cursor:pointer; }
.tab.active { background: rgba(255,255,255,0.03); color:var(--white); border-color:rgba(255,255,255,0.04); }

.chip-row { display:flex; gap:8px; align-items:center; margin-top:6px; }
.chip { padding:6px 10px; border-radius:14px; background:rgba(255,255,255,0.02); color:var(--muted); cursor:pointer; font-size:var(--fs-xs); }
.chip.active { background:var(--accent); color:white; }

.preset-area { margin-top:8px; border-radius:10px; border:1px solid rgba(255,255,255,0.02); padding:12px; background: rgba(255,255,255,0.01); box-sizing:border-box; height:140px; }
.preset-row { display:flex; gap:12px; align-items:flex-start; height:72px; overflow:hidden; }

.preset-card { width:60px; height:60px; background:#2a2a2a; border-radius:10px; display:flex; align-items:center; justify-content:center; position:relative; cursor:pointer; border:1px solid rgba(255,255,255,0.02); }
.preset-card .heart { position:absolute; top:8px; left:8px; width:18px; height:18px; border-radius:6px; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.02); color:var(--muted); font-size:11px; }
.preset-card .heart.fav { background:var(--accent); color:white; }
.preset-labels { display:flex; gap:22px; margin-top:8px; align-items:center; color:var(--muted-2); font-size:12px; }

.chev-wrap { position:absolute; left:50%; transform:translateX(-50%); bottom:-10px; width:28px; height:18px; display:flex; align-items:center; justify-content:center; }

/* hide scrollbars */
.panel::-webkit-scrollbar{display:none;}
.preset-area::-webkit-scrollbar{display:none;}
</style>
</head>
<body>
  <div class="wrap">
    <div class="panel" role="region" aria-label="Waysorted Unit Conversion - final">
      <!-- LEFT -->
      <div class="left">
        <div class="header">
          <div class="logo">W</div>
          <div class="plugin-title">Unit Conversion</div>
        </div>

        <!-- Unit / DPI / Add Bleed -->
        <div class="row" style="margin-top:4px;">
          <label>Unit
            <select id="unitSelect" class="small">
              <option value="MM">MM</option>
              <option value="CM">CM</option>
              <option value="M">Meter</option>
              <option value="IN">Inch</option>
              <option value="FT">Feet</option>
            </select>
          </label>

          <label>DPI
            <select id="dpiSelect" class="small">
              <option value="72">72 DPI</option>
              <option value="150">150 DPI</option>
              <option value="300">300 DPI</option>
            </select>
          </label>

          <label style="margin-left:6px; display:flex; align-items:center;">
            <input id="addBleed" type="checkbox" /> <span style="margin-left:6px;color:var(--muted);font-size:var(--fs-xs);">Add Bleed</span>
          </label>
        </div>

        <!-- sizes block: length and width rows -->
        <div class="sizes-block" style="margin-top:6px;">
          <!-- Length row -->
          <div class="size-row" style="grid-row:1/2;">
            <div class="size-label">Length</div>
            <div class="pair">
              <div class="short"><input id="lengthInput" type="number" placeholder="0"></div>
              <button id="swapLenBtn" class="swap-mini" title="swap">⇄</button>
              <div class="short"><input id="lengthInput2" type="number" placeholder=""></div>
              
            </div>
            <div class="px-inline">px</div>
          </div>

          <!-- Width row -->
          <div class="size-row" style="grid-row:2/3;">
            <div class="size-label">Width</div>
            <div class="pair">
              <div class="short"><input id="widthInput" type="number" placeholder="0"></div>
              <button id="swapWidBtn" class="swap-mini" title="swap">⇄</button>
              <div class="short"><input id="widthInput2" type="number" placeholder=""></div>
              
            </div>
            <div class="px-inline">px</div>
          </div>
        </div>

        <!-- bleed group positioned next to Add Bleed (left-panel absolute) -->
        <div class="bleed-block" aria-hidden="false">
          <div class="bleed-row">
            <div class="bleed-cell">
              <div class="bleed-label">Top</div>
              <div class="bleed-input"><input id="bleedTop" type="number" placeholder=""></div>
            </div>
            <div class="bleed-cell">
              <div class="bleed-label">Bottom</div>
              <div class="bleed-input"><input id="bleedBottom" type="number" placeholder=""></div>
            </div>
          </div>
          <div class="bleed-row">
            <div class="bleed-cell">
              <div class="bleed-label">Left</div>
              <div class="bleed-input"><input id="bleedLeft" type="number" placeholder=""></div>
            </div>
            <div class="bleed-cell">
              <div class="bleed-label">Right</div>
              <div class="bleed-input"><input id="bleedRight" type="number" placeholder=""></div>
            </div>
          </div>
        </div>

        <!-- Buttons (moved down a little) -->
        <div class="actions">
          <button id="exportBtn" class="btn">Export as Frame</button>
          <button id="savePresetBtn" class="btn ghost">Save As Preset</button>
          <button id="orientationBtn" class="btn ghost">Orientation</button>
        </div>
      </div>

      <!-- RIGHT (presets) -->
      <div class="right">
        <div class="presets-header">
          <div style="display:flex;flex-direction:column;">
            <div style="font-weight:600;color:var(--white);">Your Presets</div>
            <div class="tabs" style="margin-top:6px;">
              <button id="tabYour" class="tab active">Your Presets</button>
              <button id="tabAll" class="tab">All Presets</button>
            </div>
          </div>

          <div style="display:flex;flex-direction:column;align-items:flex-end;">
            <div class="chip-row">
              <div id="chipAll" class="chip active">All</div>
              <div id="chipFav" class="chip">Favorites</div>
            </div>
          </div>
        </div>

        <div class="preset-area">
          <div class="preset-row" id="presetRow" role="list" aria-label="Presets row"></div>
          <div class="preset-labels" id="presetLabels"></div>
          <div class="preset-footer"></div>
        </div>
      </div>

      <div class="chev-wrap" aria-hidden="true">
        <svg width="20" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 10L12 16L18 10" stroke="rgba(255,255,255,0.9)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
    </div>
  </div>

<script>
/* plugin comms */
function postToPlugin(msg){ parent.postMessage({ pluginMessage: msg }, '*'); }
window.onmessage = (e) => {
  const msg = e.data.pluginMessage;
  if (!msg) return;
  if (msg.type === 'export-ready') {
    const base64 = msg.base64;
    const fileName = msg.fileName || 'export.png';
    const binary = atob(base64);
    const len = binary.length;
    const u8 = new Uint8Array(len);
    for (let i=0;i<len;i++) u8[i] = binary.charCodeAt(i);
    const blob = new Blob([u8], { type:'image/png' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = fileName; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }
};

/* UI refs */
const unitSelect = document.getElementById('unitSelect');
const dpiSelect = document.getElementById('dpiSelect');
const addBleed = document.getElementById('addBleed');
const lengthInput = document.getElementById('lengthInput');
const lengthInput2 = document.getElementById('lengthInput2');
const widthInput = document.getElementById('widthInput');
const widthInput2 = document.getElementById('widthInput2');
const bleedTop = document.getElementById('bleedTop');
const bleedBottom = document.getElementById('bleedBottom');
const bleedLeft = document.getElementById('bleedLeft');
const bleedRight = document.getElementById('bleedRight');
const exportBtn = document.getElementById('exportBtn');
const savePresetBtn = document.getElementById('savePresetBtn');
const swapLenBtn = document.getElementById('swapLenBtn');
const swapWidBtn = document.getElementById('swapWidBtn');
const tabYour = document.getElementById('tabYour');
const tabAll = document.getElementById('tabAll');
const chipAll = document.getElementById('chipAll');
const chipFav = document.getElementById('chipFav');
const presetRow = document.getElementById('presetRow');
const presetLabels = document.getElementById('presetLabels');

/* in-memory presets (demo) */
let presets = [
  {_id:'p1', title:'Banner', width:800, height:300, unit:'MM', dpi:72, favorite:true},
  {_id:'p2', title:'V-Card', width:350, height:200, unit:'MM', dpi:72, favorite:false},
  {_id:'p3', title:'Standee', width:800, height:1800, unit:'MM', dpi:72, favorite:false},
  {_id:'p4', title:'Bi fold', width:420, height:297, unit:'MM', dpi:72, favorite:false},
  {_id:'p5', title:'Brochure', width:210, height:297, unit:'MM', dpi:72, favorite:false}
];

let activeTab = 'your';
let activeChip = 'all';

function renderPresets(){
  presetRow.innerHTML = '';
  presetLabels.innerHTML = '';
  let items = presets.slice();
  if (activeTab === 'your') items = items;
  if (activeChip === 'fav') items = items.filter(p => p.favorite);

  items.slice(0,8).forEach(p => {
    const c = document.createElement('div'); c.className='preset-card';
    const heart = document.createElement('div'); heart.className='heart' + (p.favorite? ' fav':''); heart.innerHTML = p.favorite ? '♥' : '♡';
    heart.addEventListener('click', (ev)=>{ ev.stopPropagation(); p.favorite=!p.favorite; heart.classList.toggle('fav', p.favorite); heart.innerHTML = p.favorite ? '♥' : '♡'; });
    c.appendChild(heart);
    c.addEventListener('click', ()=> { applyPreset(p); });
    presetRow.appendChild(c);

    const lbl = document.createElement('div'); lbl.style.minWidth='60px'; lbl.style.textAlign='center'; lbl.style.fontSize='12px'; lbl.style.color='var(--muted-2)'; lbl.textContent = p.title;
    presetLabels.appendChild(lbl);
  });

  // placeholders so labels line up like screenshot
  const current = presetRow.children.length;
  for (let i=current; i<5; i++){
    const blank = document.createElement('div'); blank.style.width='60px'; blank.style.height='60px'; blank.style.marginRight='12px';
    presetRow.appendChild(blank);
    const blankLabel = document.createElement('div'); blankLabel.style.minWidth='60px'; blankLabel.style.visibility='hidden';
    presetLabels.appendChild(blankLabel);
  }
}

function applyPreset(p){
  lengthInput.value = p.height || '';
  lengthInput2.value = '';
  widthInput.value = p.width || '';
  widthInput2.value = '';
  unitSelect.value = p.unit || 'MM';
  dpiSelect.value = p.dpi ? String(p.dpi) : '72';
}

/* events */
exportBtn.addEventListener('click', ()=>{
  const dpi = Number(dpiSelect.value) || 72;
  postToPlugin({ type:'export-frame', dpi, fileName: 'export.png' });
});

savePresetBtn.addEventListener('click', ()=>{
  const title = prompt('Preset name (demo)');
  if(!title) return;
  const newP = {_id:'p'+Date.now(), title, width:Number(widthInput.value)||0, height:Number(lengthInput.value)||0, unit:unitSelect.value||'MM', dpi:Number(dpiSelect.value)||72, favorite:false};
  presets.unshift(newP);
  renderPresets();
});

swapLenBtn.addEventListener('click', ()=>{
  const t = lengthInput.value; lengthInput.value = lengthInput2.value; lengthInput2.value = t;
});
swapWidBtn.addEventListener('click', ()=>{
  const t = widthInput.value; widthInput.value = widthInput2.value; widthInput2.value = t;
});

tabYour.addEventListener('click', ()=>{ activeTab='your'; tabYour.classList.add('active'); tabAll.classList.remove('active'); renderPresets(); });
tabAll.addEventListener('click', ()=>{ activeTab='all'; tabAll.classList.add('active'); tabYour.classList.remove('active'); renderPresets(); });

chipAll.addEventListener('click', ()=>{ activeChip='all'; chipAll.classList.add('active'); chipFav.classList.remove('active'); renderPresets(); });
chipFav.addEventListener('click', ()=>{ activeChip='fav'; chipFav.classList.add('active'); chipAll.classList.remove('active'); renderPresets(); });

/* initial render */
renderPresets();
</script>
</body>
</html>
